<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>招生计划</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet" type="text/css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.min.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<nav class="navbar navbar-default">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <a class="navbar-brand" href="#">云南大学</a>
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#">首页</a></li>
                <li><a href="#">招生政策</a></li>
                <li><a href="#">招生计划</a></li>
                <li><a href="#">往年招生</a></li>
                <li><a href="#">院系专业</a></li>
                <li><a href="#">走进云大</a></li>
                <li><a href="#">公示信息</a></li>
                <li><a href="#">联系我们</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container-fluid -->
</nav>
<div class="container">
    <div class="row">
        <div class="col-lg-2 col-md-2 left-sidebar visible-md visible-lg">
            <ul class="sidebar-nav nav nav-stacked">
                <h4 class="">报名系统</h4>
                <li><a href="">云南大学2016年高校专项计划招生网上报名系统</a></li>
                <li><a href="">云南大学2016年高校专项计划招生网上报名系统</a></li>
            </ul>
            <ul class="sidebar-nav nav nav-stacked">
                <h4 class="">导航</h4>
                <li><a href="/">首页</a></li>
                <li><a href="$cms.getUrl("招生政策")">招生政策</a></li>
                <li><a href="$cms.getUrl("招生计划")">招生计划</a></li>
                <li><a href="$cms.getUrl("往年招生")">往年招生</a></li>
                <li><a href="$cms.getUrl("院系专业")">院系专业</a></li>
                <li><a href="$cms.getUrl("走进云大")">走进云大</a></li>
                <li><a href="$cms.getUrl("公示信息")">公示信息</a></li>
                <li><a href="$cms.getUrl("联系我们")">联系我们</a></li>
            </ul>
            <ul class="sidebar-nav nav nav-stacked">
                <h4 class="">友情链接</h4>
                <li><a href="">云南大学</a></li>
                <li><a href="">教务处</a></li>
                <li><a href="">现代教育技术中心</a></li>
            </ul>
            <ul class="sidebar-nav">
                <h4 class="">云南大学本科招生办公室官方微信号</h4>
                <img src="images/zbwx.jpg" alt="...">
            </ul>
        </div>

        <div class="col-lg-10 col-md-10">
            <ul class="bread-crumb">
                <li><a href="#">首页</a>>></li>
                <li>招生计划</li>
            </ul>
            <div class="panel panel-info">
                <div class="panel-body">
                    <p class="lead">全国招生概要信息</p>
                    <div class="itemCon">
                        <div id="ChinaMap" ></div>
                        <div id="stateTip" ></div>
                    </div>
                    <div id="mapTipContent">
                    </div>
                 </div>
            </div>
            <div class="panel panel-info">
                <div class="panel-body">
                    <p class="lead">招生信息查询</p>
                    <form class="form-horizontal">
                        <div class="form-group">
                            <label for="province" class="col-sm-2 control-label">选择省份</label>
                            <div class="col-sm-10">
                                <select id="province" name="province" class="form-control">
                                </select>
                            </div>
                        </div>
                    </form>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                            <tr><th>专业名称/专业类别/专业代码</th><th>招生计划人数</th></tr>
                            </thead>
                            <tbody id="table_data_body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
<footer class="footer">
    <div class="container-fluid">
        <span>联系地址：云南省昆明市翠湖北路2号云南大学教务处招生办公室</span>
        <span>邮政编码：650091 </span>
        <span>电话：0871-65033819 </span>
        <br/>
        <span>本网站所有内容版权归云南大学招生办公室所有，未经书面允许，任何单位和个人不得转载。</span>
    </div>
</footer>

<div style="display: none" id="template">
    <div class="mapTipText">
        <div class="mapTipList">
            <h3><span class="tip_name"></span></h3>
            <table class="table plan">
                <tbody>
                <tr>
                    <td>计划总数</td>
                    <td>文史</td>
                    <td>理工</td>
                    <td>艺术(文)</td>
                    <td>艺术(理)</td>
                    <td>体育类</td>
                </tr>
                <tr>
                    <td><span class="tip_total"></span></td>
                    <td><span class="tip_wenshi"></span></td>
                    <td><span class="tip_ligong"></span></td>
                    <td><span class="tip_yishuwen"></span></td>
                    <td><span class="tip_yishuli"></span></td>
                    <td><span class="tip_tiyulei"></span></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>


<script src="js/jquery-2.2.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/sprintf.min.js"></script>
<script src="js/raphael-min.js"></script>
<script src="js/chinaMapConfig.js"></script>
<script src="js/map-min.js"></script>
<script type="text/javascript">
    jQuery(function(){
        var province = jQuery("select[name='province']");
        province.empty();
        var meta_info, column_length, data;
        var header = [];

        // category index with "文史 理工 艺术(文) 艺术(理) 体育类"
        var category_indexes = [[],[],[],[],[]];
        var summary_data = [];

        var table_body = jQuery("#table_data_body");
        $.getJSON( "js/data.json", function( all_in_one_data ) {
            meta_info = all_in_one_data.meta_info;
            column_length = meta_info.major_id.length;
            data = all_in_one_data.data;

            // find category indexes
            jQuery(meta_info.major_category).each(function (i, v) {
                if (v == "文史") {
                    category_indexes[0].push(i);
                }
                else if (v == "理工") {
                    category_indexes[1].push(i);
                }
                else if (v == "艺术(文)") {
                    category_indexes[2].push(i);
                }
                else if (v == "艺术(理)") {
                    category_indexes[3].push(i);
                }
                else if (v == "体育类") {
                    category_indexes[4].push(i);
                }
            });

            // dynamic generate options of select
            jQuery(data).each(function (i, v) {
                province.append(jQuery("<option>", {value: v.province_pinyin, html: v.province}));
            });

            // calculate the summary data
            jQuery(data).each(function (i, v) {
                var relevant_summary_data = [0, 0, 0, 0, 0, 0];
                jQuery(v.data).each(function (index, count) {
                    relevant_summary_data[0] += count;
                    if (category_indexes[0].indexOf(index) != -1) {
                        relevant_summary_data[1] += count;
                    }
                    else if (category_indexes[1].indexOf(index) != -1) {
                        relevant_summary_data[2] += count;
                    }
                    else if (category_indexes[2].indexOf(index) != -1) {
                        relevant_summary_data[3] += count;
                    }
                    else if (category_indexes[3].indexOf(index) != -1) {
                        relevant_summary_data[4] += count;
                    }
                    else if (category_indexes[4].indexOf(index) != -1) {
                        relevant_summary_data[5] += count;
                    }
                });
                summary_data.push({province: v.province, province_pinyin: v.province_pinyin, relevant_summary_data: relevant_summary_data});
            });

            // cache the first column of the table
            for(var i = 0; i < column_length; i++) {
                header.push(sprintf("%s/%s/%s", meta_info.major_name[i], meta_info.major_category[i], meta_info.major_id[i]));
            }
        });

        province.change(function() {
            var select_value = jQuery("select option:selected").val();
            var relevant_data;
            for(var i = 0; i < data.length; i ++) {
                if(data[i].province_pinyin == select_value) {
                    relevant_data = data[i].data;
                }
            }
            table_body.empty();
            if(relevant_data) {
                for(var i = 0; i < column_length; i++) {
                    table_body.append(sprintf("<tr><td>%s</td><td>%s</td></tr>", header[i], relevant_data[i] ? relevant_data[i] : "-"));
                }
            }
        });

        // operation after initialization
        setTimeout(function() {
            province.val("yunnan");
            province.change();

            var mapTipContent = jQuery("#mapTipContent");
            var mapTipContentTemplate = jQuery("div.mapTipText", jQuery("#template"));
            var province_id_map = {
                "heilongjiang":0,
                "jilin":1,
                "liaoning":2,
                "hebei":3,
                "shandong":4,
                "jiangsu":5,
                "zhejiang":6,
                "anhui":7,
                "henan":8,
                "shanxi":9,
                "shaanxi":10,
                "gansu":11,
                "hubei":12,
                "jiangxi":13,
                "fujian":14,
                "hunan":15,
                "guizhou":16,
                "sichuan":17,
                "yunnan":18,
                "qinghai":19,
                "hainan":20,
                "shanghai":21,
                "chongqing":22,
                "tianjin":23,
                "beijing":24,
                "ningxia":25,
                "neimenggu":26,
                "guangxi":27,
                "xinjiang":28,
                "xizang":29,
                "guangdong":30,
                "xianggang":31,
                "taiwan":32,
                "aomen":33
            };
            mapTipContent.empty();
            jQuery(summary_data).each(function(i, value) {
                var id = province_id_map[value.province_pinyin];
                var mapTip = mapTipContentTemplate.clone();
                mapTip.addClass("mapTipText" + id);
                jQuery(".tip_name", mapTip).text(value.province);
                jQuery(".tip_total", mapTip).text(value.relevant_summary_data[0]);
                jQuery(".tip_wenshi", mapTip).text(value.relevant_summary_data[1]);
                jQuery(".tip_ligong", mapTip).text(value.relevant_summary_data[2]);
                jQuery(".tip_yishuwen", mapTip).text(value.relevant_summary_data[3]);
                jQuery(".tip_yishuli", mapTip).text(value.relevant_summary_data[4]);
                jQuery(".tip_tiyulei", mapTip).text(value.relevant_summary_data[5]);
                mapTipContent.append(mapTip);
            }) ;

            initMap(jQuery("#ChinaMap").parent().width(), jQuery("#ChinaMap").parent().width() * 0.75);

        }, 0);


        function initMap(width, height) {
            jQuery("#ChinaMap").SVGMap({
                mapWidth: width ? width : jQuery("#ChinaMap").parent().width(),
                mapHeight: height ? height : jQuery("#ChinaMap").parent().height()
            });
        }

        jQuery(window).resize(function() {
            initMap();
        });

    });
</script>
</body>
</html>